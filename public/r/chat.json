{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "chat",
  "type": "registry:block",
  "title": "Chat UI Primitives",
  "description": "Visual building blocks: chat container, messages, input, and status indicators.",
  "registryDependencies": [
    "button",
    "scroll-area",
    "textarea",
    "tooltip",
    "spinner",
    "command",
    "popover",
    "https://ui.inference.sh/r/markdown.json"
  ],
  "files": [
    {
      "path": "registry/blocks/chat/components/chat-container.tsx",
      "content": "/**\n * ChatContainer Primitive\n * \n * A layout wrapper for the chat UI using CSS Grid.\n * Provides structure: [header] [messages] [input]\n */\n\nimport React, { forwardRef } from 'react';\nimport { cn } from '@/lib/utils';\nimport type { ChatContainerProps } from '@/components/agent/types';\n\n/**\n * ChatContainer - Grid layout wrapper for chat components\n * \n * @example\n * ```tsx\n * <ChatContainer className=\"h-screen\">\n *   <Header />\n *   <ChatMessages>...</ChatMessages>\n *   <ChatInput />\n * </ChatContainer>\n * ```\n */\nexport const ChatContainer = forwardRef<HTMLDivElement, ChatContainerProps>(\n  ({ children, className }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          'grid max-h-full w-full grid-rows-[auto_1fr_auto]',\n          className\n        )}\n      >\n        {children}\n      </div>\n    );\n  }\n);\n\nChatContainer.displayName = 'ChatContainer';\n\n",
      "type": "registry:component",
      "target": "components/agent/chat-container.tsx"
    },
    {
      "path": "registry/blocks/chat/components/chat-input.tsx",
      "content": "/**\n * ChatInput Primitive\n * \n * Auto-resizing textarea with file upload support.\n * Supports @file references with autocomplete.\n */\n\nimport React, { useState, useRef, useEffect, useCallback, memo } from 'react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { ArrowUp, Square, ImagePlus, Paperclip, File as FileIcon, AlertCircle, X } from 'lucide-react';\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from '@/components/ui/command';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { useAgent, useAgentActions } from '@/hooks/use-agent';\nimport {\n  useFileUploadManager,\n  FileUploadList,\n  showFileUploadDialog,\n  type FileUpload,\n} from '@/components/agent/file-upload';\nimport type { ChatInputProps } from '@/components/agent/types';\n\n// =============================================================================\n// Drag Overlay Component (CSS transitions)\n// =============================================================================\n\ninterface DragOverlayProps {\n  isDragging: boolean;\n}\n\nconst DragOverlay = memo(function DragOverlay({ isDragging }: DragOverlayProps) {\n  if (!isDragging) return null;\n\n  return (\n    <div\n      className=\"pointer-events-none absolute inset-0 z-20 flex items-center justify-center rounded-2xl border-2 border-dashed border-primary/50 bg-primary/5 animate-in fade-in duration-150\"\n    >\n      <div className=\"flex flex-col items-center gap-2 text-primary\">\n        <Paperclip className=\"h-6 w-6\" />\n        <span className=\"text-sm font-medium\">drop files to upload</span>\n      </div>\n    </div>\n  );\n});\n\n// =============================================================================\n// ChatInput Component\n// =============================================================================\n\n/**\n * ChatInput - Self-contained input with file upload and auto-resize\n * \n * @example\n * ```tsx\n * <ChatInput placeholder=\"Ask me anything...\" allowAttachments />\n * ```\n */\nexport const ChatInput = memo(function ChatInput({\n  placeholder = 'ask a question...',\n  className,\n  allowAttachments,\n  allowFiles = true,\n  allowImages = true,\n}: ChatInputProps) {\n  // Backwards compatibility: if allowAttachments is explicitly false, disable both\n  const showFileButton = allowAttachments !== false && allowFiles;\n  const showImageButton = allowAttachments !== false && allowImages;\n  const enableAttachments = showFileButton || showImageButton;\n  const { isGenerating, error } = useAgent();\n  const { sendMessage, stopGeneration, clearError } = useAgentActions();\n\n  const [value, setValue] = useState('');\n  const [isDragging, setIsDragging] = useState(false);\n  const [showCommandMenu, setShowCommandMenu] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const dragCounterRef = useRef(0);\n\n  // File upload manager\n  const {\n    uploads,\n    addFiles,\n    removeUpload,\n    cancelUpload,\n    getCompletedFiles,\n  } = useFileUploadManager();\n\n  // Check if we have any pending/uploading files\n  const hasPendingUploads = uploads.some(u => u.status === 'uploading' || u.status === 'pending');\n  const hasCompletedUploads = uploads.some(u => u.status === 'completed');\n  const completedUploads = uploads.filter(u => u.status === 'completed');\n\n  // Auto-resize textarea\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    textarea.style.height = 'auto';\n    const newHeight = Math.min(textarea.scrollHeight, 200);\n    textarea.style.height = `${newHeight}px`;\n  }, [value]);\n\n  // Add @filename reference to text\n  const addFileReferenceToText = useCallback((upload: FileUpload) => {\n    const fileName = upload.file.name;\n    const text = `@${fileName} `;\n    setValue(prev => {\n      const needsSpace = prev && !prev.endsWith(' ');\n      return `${prev}${needsSpace ? ' ' : ''}${text}`;\n    });\n\n    // Focus textarea and move cursor to end\n    if (textareaRef.current) {\n      textareaRef.current.focus();\n      setTimeout(() => {\n        if (textareaRef.current) {\n          const length = textareaRef.current.value.length;\n          textareaRef.current.setSelectionRange(length, length);\n        }\n      }, 0);\n    }\n  }, []);\n\n  // Handle send\n  const handleSend = useCallback(async () => {\n    let messageText = value.trim();\n\n    // Don't send if uploading\n    if (hasPendingUploads) return;\n\n    // Need either text or completed files\n    if (!messageText && !hasCompletedUploads) return;\n\n    if (isGenerating) return;\n\n    // Get already-uploaded files (FileDTO objects)\n    const completedFiles = getCompletedFiles();\n\n    // Replace @filename references with file URIs\n    completedFiles.forEach(file => {\n      // Get the original filename from the file\n      const fileName = file.filename || file.uri.split('/').pop() || '';\n      const fileRef = `@${fileName}`;\n      if (messageText.includes(fileRef) && file.uri) {\n        messageText = messageText.replaceAll(fileRef, file.uri);\n      }\n    });\n\n    // Also check uploads for filenames (in case filename differs from URI)\n    uploads.forEach(u => {\n      if (u.status === 'completed' && u.uploadedFile?.uri) {\n        const fileRef = `@${u.file.name}`;\n        if (messageText.includes(fileRef)) {\n          messageText = messageText.replaceAll(fileRef, u.uploadedFile.uri);\n        }\n      }\n    });\n\n    setValue('');\n\n    // Clear uploads after sending\n    uploads.forEach(u => {\n      if (u.status === 'completed' || u.status === 'failed' || u.status === 'cancelled') {\n        removeUpload(u.id);\n      }\n    });\n\n    // Pass FileDTO objects - SDK now detects they have uri and skips re-upload\n    await sendMessage(messageText, completedFiles.length > 0 ? completedFiles : undefined);\n  }, [value, hasPendingUploads, hasCompletedUploads, isGenerating, getCompletedFiles, uploads, removeUpload, sendMessage]);\n\n  // Handle key down\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      // Show command menu when @ is typed (and we have uploaded files)\n      if (e.key === '@' && completedUploads.length > 0) {\n        e.preventDefault();\n        setShowCommandMenu(true);\n      }\n\n      // Hide command menu on Escape\n      if (e.key === 'Escape') {\n        setShowCommandMenu(false);\n      }\n\n      // Submit on Enter (without Shift)\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        handleSend();\n      }\n    },\n    [handleSend, completedUploads.length]\n  );\n\n  // Handle paste\n  const handlePaste = useCallback((e: React.ClipboardEvent) => {\n    if (!enableAttachments) return;\n\n    const items = e.clipboardData?.items;\n    if (!items) return;\n\n    const files: File[] = [];\n    for (const item of items) {\n      const file = item.getAsFile();\n      if (file) {\n        files.push(file);\n      }\n    }\n\n    if (files.length > 0) {\n      addFiles(files);\n    }\n  }, [allowAttachments, addFiles]);\n\n  // Drag and drop handlers\n  const handleDragEnter = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounterRef.current++;\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\n      setIsDragging(true);\n    }\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounterRef.current--;\n    if (dragCounterRef.current === 0) {\n      setIsDragging(false);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n    dragCounterRef.current = 0;\n\n    if (!enableAttachments) return;\n\n    const files = Array.from(e.dataTransfer.files);\n    if (files.length > 0) {\n      addFiles(files);\n    }\n  }, [enableAttachments, addFiles]);\n\n  // Handle attachment button click\n  const handleAttachmentClick = async () => {\n    const files = await showFileUploadDialog();\n    if (files) {\n      addFiles(files);\n    }\n  };\n\n  // Handle image button click\n  const handleImageClick = async () => {\n    const files = await showFileUploadDialog('image/*');\n    if (files) {\n      addFiles(files);\n    }\n  };\n\n  const canSend = (value.trim().length > 0 || hasCompletedUploads) && !isGenerating && !hasPendingUploads;\n\n  return (\n    <div className=\"relative\">\n      {/* Error notification - floats above input */}\n      {error && (\n        <div className=\"absolute -top-10 left-0 right-0 flex items-center justify-center animate-in fade-in slide-in-from-bottom-2 duration-200\">\n          <div className=\"flex items-center gap-2 px-3 py-1.5 rounded-full bg-destructive/10 border border-destructive/20 text-destructive text-xs\">\n            <AlertCircle className=\"h-3 w-3 shrink-0\" />\n            <span className=\"line-clamp-1\">failed to send: {error}</span>\n            <button\n              onClick={clearError}\n              className=\"shrink-0 rounded-full p-0.5 hover:bg-destructive/20 transition-colors\"\n            >\n              <X className=\"h-3 w-3\" />\n            </button>\n          </div>\n        </div>\n      )}\n\n      <div\n        ref={containerRef}\n        className={cn(\n          'relative flex w-full flex-col gap-2 rounded-2xl border bg-muted/30 p-3',\n          isDragging && 'ring-2 ring-primary/50',\n          className\n        )}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n      >\n        {/* File uploads */}\n      {uploads.length > 0 && (\n        <FileUploadList\n          uploads={uploads}\n          onRemove={removeUpload}\n          onCancel={cancelUpload}\n          className=\"pb-2\"\n        />\n      )}\n\n      {/* Text area with @ file reference popover */}\n      <div className=\"relative\">\n        <Popover open={showCommandMenu} onOpenChange={setShowCommandMenu}>\n          {/* Hidden trigger for popover positioning */}\n          <PopoverTrigger asChild>\n            <div className=\"w-0 h-0 absolute\" />\n          </PopoverTrigger>\n          <PopoverContent className=\"p-0 w-64\" align=\"start\" side=\"top\" sideOffset={8}>\n            <Command className=\"rounded-lg border-none\">\n              <CommandInput placeholder=\"search files...\" />\n              <CommandList>\n                <CommandEmpty>no files uploaded.</CommandEmpty>\n                {completedUploads.length > 0 && (\n                  <CommandGroup heading=\"Files\">\n                    {completedUploads.map((upload) => (\n                      <CommandItem\n                        key={upload.id}\n                        onSelect={() => {\n                          addFileReferenceToText(upload);\n                          setShowCommandMenu(false);\n                        }}\n                        className=\"cursor-pointer\"\n                      >\n                        <FileIcon className=\"mr-2 h-4 w-4\" />\n                        <span className=\"truncate\">{upload.file.name}</span>\n                      </CommandItem>\n                    ))}\n                  </CommandGroup>\n                )}\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n\n        <textarea\n          ref={textareaRef}\n          value={value}\n          onChange={(e) => setValue(e.target.value)}\n          onKeyDown={handleKeyDown}\n          onPaste={handlePaste}\n          placeholder={placeholder}\n          // disabled={isGenerating}\n          rows={1}\n          className={cn(\n            'w-full resize-none bg-transparent text-sm',\n            'placeholder:text-muted-foreground/50',\n            'focus:outline-none',\n            'disabled:opacity-50 disabled:cursor-not-allowed',\n            'min-h-[24px] max-h-[200px]'\n          )}\n        />\n      </div>\n\n      {/* Toolbar */}\n      <div className=\"flex items-center justify-between\">\n        {/* Left side - action buttons */}\n        <div className=\"flex items-center gap-1\">\n          {showFileButton && (\n            <Button\n              type=\"button\"\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-8 w-8 text-muted-foreground hover:text-foreground cursor-pointer\"\n              onClick={handleAttachmentClick}\n              disabled={isGenerating}\n              aria-label=\"Attach file\"\n            >\n              <Paperclip className=\"h-4 w-4\" />\n            </Button>\n          )}\n          {showImageButton && (\n            <Button\n              type=\"button\"\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-8 w-8 text-muted-foreground hover:text-foreground cursor-pointer\"\n              onClick={handleImageClick}\n              disabled={isGenerating}\n              aria-label=\"Attach image\"\n            >\n              <ImagePlus className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n\n        {/* Right side - send/stop button */}\n        <div className=\"flex items-center gap-2\">\n          {isGenerating ? (\n            <Button\n              type=\"button\"\n              size=\"icon\"\n              variant=\"default\"\n              onClick={stopGeneration}\n              className=\"h-8 w-8 rounded-full cursor-pointer\"\n              aria-label=\"Stop generating\"\n            >\n              <Square className=\"h-3 w-3\" fill=\"currentColor\" />\n            </Button>\n          ) : (\n            <Button\n              type=\"button\"\n              size=\"icon\"\n              onClick={handleSend}\n              disabled={!canSend}\n              className=\"h-8 w-8 rounded-full cursor-pointer\"\n              aria-label=\"Send message\"\n            >\n              <ArrowUp className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      </div>\n\n        {/* Drag overlay */}\n        <DragOverlay isDragging={isDragging} />\n      </div>\n    </div>\n  );\n});\n\nChatInput.displayName = 'ChatInput';\n",
      "type": "registry:component",
      "target": "components/agent/chat-input.tsx"
    },
    {
      "path": "registry/blocks/chat/components/chat-messages.tsx",
      "content": "/**\n * ChatMessages Primitive\n * \n * A container for messages with auto-scroll behavior.\n * Uses render prop pattern for maximum flexibility.\n */\n\nimport React, { memo, useState, useLayoutEffect } from 'react';\nimport { cn } from '@/lib/utils';\nimport { useAutoScroll } from '@/hooks/use-auto-scroll';\nimport { Button } from '@/components/ui/button';\nimport { ArrowDown } from 'lucide-react';\nimport { useAgent } from '@/hooks/use-agent';\nimport type { ChatMessagesProps } from '@/components/agent/types';\n\n/**\n * ChatMessages - Scrollable message container with render prop\n * \n * @example\n * ```tsx\n * <ChatMessages>\n *   {({ messages }) => (\n *     <div className=\"space-y-4\">\n *       {messages.map(msg => (\n *         <MessageBubble key={msg.id} message={msg}>\n *           <MessageContent message={msg} />\n *         </MessageBubble>\n *       ))}\n *     </div>\n *   )}\n * </ChatMessages>\n * ```\n * \n * @example With scroll-to-top padding (allows first message to scroll to top)\n * ```tsx\n * <ChatMessages scrollToTopPadding>\n *   {({ messages }) => <MessageList messages={messages} />}\n * </ChatMessages>\n * ```\n */\nexport const ChatMessages = memo(function ChatMessages({\n  children,\n  className,\n  scrollToTopPadding = false,\n}: ChatMessagesProps) {\n  const { messages } = useAgent();\n  const [spacerHeight, setSpacerHeight] = useState(0);\n\n  const {\n    containerRef,\n    scrollToBottom,\n    handleScroll,\n    shouldAutoScroll,\n    handleTouchStart,\n  } = useAutoScroll([messages]);\n\n  // Measure container height for the scroll-to-top spacer\n  useLayoutEffect(() => {\n    if (!scrollToTopPadding || !containerRef.current) return;\n\n    const updateHeight = () => {\n      if (containerRef.current) {\n        setSpacerHeight(containerRef.current.clientHeight * 0.9);\n      }\n    };\n\n    updateHeight();\n\n    const resizeObserver = new ResizeObserver(updateHeight);\n    resizeObserver.observe(containerRef.current);\n\n    return () => resizeObserver.disconnect();\n  }, [scrollToTopPadding, containerRef]);\n\n  return (\n    <div className={cn('flex flex-col min-h-0 min-w-0 relative', className)}>\n      <div\n        ref={containerRef}\n        className=\"flex-1 overflow-y-auto min-w-0\"\n        onScroll={handleScroll}\n        onTouchStart={handleTouchStart}\n      >\n        {children({ messages })}\n        {scrollToTopPadding && messages.length > 0 && (\n          <div aria-hidden=\"true\" className=\"shrink-0\" style={{ minHeight: spacerHeight }} />\n        )}\n      </div>\n\n      {/* Scroll to bottom button */}\n      {!shouldAutoScroll && (\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2\">\n          <Button\n            onClick={scrollToBottom}\n            size=\"sm\"\n            variant=\"default\"\n            className=\"bg-background hover:bg-muted text-foreground hover:text-foreground rounded-full shadow-md animate-in fade-in-0 slide-in-from-bottom-2 cursor-pointer\"\n          >\n            <ArrowDown className=\"h-4 w-4\" />\n            <span className=\"text-xs font-normal text-muted-foreground\">scroll to bottom</span>\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n});\n\nChatMessages.displayName = 'ChatMessages';\n\n",
      "type": "registry:component",
      "target": "components/agent/chat-messages.tsx"
    },
    {
      "path": "registry/blocks/chat/components/message.tsx",
      "content": "/**\n * Message - Default message composition\n * \n * Combines MessageBubble, MessageContent, MessageReasoning, and ToolInvocations\n * into a sensible default. Use individual primitives for custom layouts.\n */\n\nimport React, { memo } from 'react';\nimport {\n  ChatMessageRoleUser,\n  ChatMessageRoleAssistant,\n  ChatMessageContentTypeReasoning,\n  ChatMessageContentTypeText,\n} from '@inferencesh/sdk';\nimport { isTerminalChatMessageStatus } from '@/components/agent/types';\nimport { MessageBubble } from '@/components/agent/message-bubble';\nimport { MessageContent } from '@/components/agent/message-content';\nimport { MessageReasoning } from '@/components/agent/message-reasoning';\nimport { ToolInvocations } from '@/components/agent/tool-invocations';\nimport type { ChatMessageDTO } from '@/components/agent/types';\n\nexport interface MessageProps {\n  message: ChatMessageDTO;\n  /** Truncate user messages */\n  truncateUser?: boolean;\n}\n\n/**\n * Default message rendering with all features:\n * - Reasoning block (collapsed, for assistant)\n * - Text content\n * - Tool invocations (for assistant)\n */\nexport const Message = memo(function Message({\n  message,\n  truncateUser = false,\n}: MessageProps) {\n  const isUser = message.role === ChatMessageRoleUser;\n  const isAssistant = message.role === ChatMessageRoleAssistant;\n\n  // Skip tool messages\n  if (message.role === 'tool') return null;\n\n  const reasoningContent = message.content?.find(\n    c => c.type === ChatMessageContentTypeReasoning\n  )?.text;\n\n  const hasText = message.content?.some(\n    c => c.type === ChatMessageContentTypeText && c.text?.trim()\n  );\n\n  const hasTools = message.tool_invocations && message.tool_invocations.length > 0;\n\n  // Skip empty messages (no text, no reasoning, no tools)\n  if (!hasText && !reasoningContent && !hasTools) return null;\n\n  const isGenerating = !isTerminalChatMessageStatus(message.status);\n\n  return (\n    <MessageBubble message={message}>\n      {isAssistant && reasoningContent && (\n        <MessageReasoning\n          reasoning={reasoningContent}\n          isReasoning={isGenerating && !hasText}\n        />\n      )}\n      <MessageContent message={message} truncate={isUser && truncateUser} />\n      {isAssistant && <ToolInvocations message={message} />}\n    </MessageBubble>\n  );\n});\n\n",
      "type": "registry:component",
      "target": "components/agent/message.tsx"
    },
    {
      "path": "registry/blocks/chat/components/message-bubble.tsx",
      "content": "/**\n * MessageBubble Primitive\n * \n * Styled container for a chat message.\n */\n\nimport React, { memo } from 'react';\nimport { cn } from '@/lib/utils';\nimport { ChatMessageRoleUser } from '@inferencesh/sdk';\nimport type { MessageBubbleProps } from '@/components/agent/types';\n\n/**\n * MessageBubble - Styled container for messages\n * \n * @example\n * ```tsx\n * <MessageBubble message={message}>\n *   <MessageContent message={message} />\n *   <ToolInvocations message={message} />\n * </MessageBubble>\n * ```\n */\nexport const MessageBubble = memo(function MessageBubble({\n  message,\n  children,\n  className,\n}: MessageBubbleProps) {\n  const isUser = message.role === ChatMessageRoleUser;\n  // Check if any tool invocation has a widget\n  // const hasWidget = message.tool_invocations?.some(inv => inv.widget != null);\n  return (\n    <div\n      className={cn(\n        'group relative w-full',\n        isUser ? 'flex justify-end' : 'flex justify-start',\n        className\n      )}\n    >\n      <div\n        className={cn(\n          'relative rounded-xl text-sm',\n          isUser\n            ? 'bg-muted/50 text-foreground max-w-[70%] min-w-0 p-3'\n            : 'text-foreground max-w-full min-w-0',\n          // Widgets should take full width\n          // hasWidget && 'w-full'\n        )}\n      >\n        {children}\n      </div>\n    </div>\n  );\n});\n\nMessageBubble.displayName = 'MessageBubble';\n\n",
      "type": "registry:component",
      "target": "components/agent/message-bubble.tsx"
    },
    {
      "path": "registry/blocks/chat/components/message-content.tsx",
      "content": "/**\n * MessageContent Primitive\n * \n * Renders message text content with markdown support.\n */\n\nimport React, { memo, useState } from 'react';\nimport { cn } from '@/lib/utils';\nimport { MarkdownRenderer } from '@/components/markdown-renderer';\nimport { Button } from '@/components/ui/button';\nimport { FileIcon, ExternalLink } from 'lucide-react';\nimport {\n  ChatMessageRoleUser,\n  ChatMessageContentTypeText,\n  ChatMessageContentTypeImage,\n  ChatMessageContentTypeFile,\n} from '@inferencesh/sdk';\nimport type { MessageContentProps, ChatMessageDTO } from '@/components/agent/types';\n\n// =============================================================================\n// Helper functions\n// =============================================================================\n\nfunction getTextContent(message: ChatMessageDTO): string {\n  const textContent = message.content.find((c) => c.type === ChatMessageContentTypeText);\n  return textContent?.text ?? '';\n}\n\nfunction getImageUrls(message: ChatMessageDTO): string[] {\n  return message.content\n    .filter((c) => c.type === ChatMessageContentTypeImage && c.image)\n    .map((c) => c.image!);\n}\n\nfunction getFileUrls(message: ChatMessageDTO): string[] {\n  return message.content\n    .filter((c) => c.type === ChatMessageContentTypeFile && c.file)\n    .map((c) => c.file!);\n}\n\nfunction getFileName(url: string): string {\n  // Try to extract filename from URL\n  const parts = url.split('/');\n  const lastPart = parts[parts.length - 1];\n  // Remove query params\n  return lastPart.split('?')[0] || 'file';\n}\n\nfunction getFileExtension(filename: string): string {\n  const ext = filename.split('.').pop()?.toUpperCase() || '';\n  return ext.length <= 5 ? ext : ext.slice(0, 5);\n}\n\nfunction isImageUrl(url: string): boolean {\n  const ext = url.split('?')[0].split('.').pop()?.toLowerCase() || '';\n  return ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp'].includes(ext);\n}\n\nfunction isVideoUrl(url: string): boolean {\n  const ext = url.split('?')[0].split('.').pop()?.toLowerCase() || '';\n  return ['mp4', 'webm', 'mov', 'avi', 'mkv'].includes(ext);\n}\n\n// =============================================================================\n// File Attachment Component\n// =============================================================================\n\ninterface FileAttachmentProps {\n  url: string;\n  className?: string;\n}\n\nconst FileAttachment = memo(function FileAttachment({ url, className }: FileAttachmentProps) {\n  const fileName = getFileName(url);\n  const extension = getFileExtension(fileName);\n  const isImage = isImageUrl(url);\n  const isVideo = isVideoUrl(url);\n\n  return (\n    <a\n      href={url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={cn(\n        'flex items-center gap-2.5 rounded-lg border bg-muted/30 p-2 pr-3',\n        'hover:bg-muted/50 transition-colors cursor-pointer',\n        'max-w-[240px]',\n        className\n      )}\n    >\n      {/* Thumbnail */}\n      <div className=\"relative h-10 w-10 shrink-0 overflow-hidden rounded-md border bg-muted\">\n        {isImage ? (\n          <img\n            src={url}\n            alt={fileName}\n            className=\"h-full w-full object-cover\"\n          />\n        ) : isVideo ? (\n          <div className=\"relative h-full w-full bg-black/10\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <div className=\"rounded-full bg-white/90 p-1\">\n                <svg className=\"h-3 w-3 text-black\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path d=\"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"flex h-full w-full flex-col items-center justify-center\">\n            <FileIcon className=\"h-4 w-4 text-muted-foreground\" />\n            <span className=\"text-[7px] font-medium text-muted-foreground mt-0.5\">\n              {extension}\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* File info */}\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"truncate text-xs font-medium\">{fileName}</p>\n        <p className=\"text-[10px] text-muted-foreground flex items-center gap-1\">\n          <ExternalLink className=\"h-2.5 w-2.5\" />\n          open file\n        </p>\n      </div>\n    </a>\n  );\n});\n\n// =============================================================================\n// Image Attachment Component\n// =============================================================================\n\ninterface ImageAttachmentProps {\n  url: string;\n  className?: string;\n}\n\nconst ImageAttachment = memo(function ImageAttachment({ url, className }: ImageAttachmentProps) {\n  return (\n    <a\n      href={url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={cn(\n        'block overflow-hidden rounded-lg border cursor-pointer',\n        'hover:opacity-90 transition-opacity',\n        className\n      )}\n    >\n      <img\n        src={url}\n        alt=\"Attached image\"\n        className=\"max-w-[300px] max-h-[300px] object-contain\"\n      />\n    </a>\n  );\n});\n\n// =============================================================================\n// Component\n// =============================================================================\n\n/**\n * MessageContent - Renders message text with markdown\n * \n * @example\n * ```tsx\n * <MessageContent message={message} />\n * ```\n */\nexport const MessageContent = memo(function MessageContent({\n  message,\n  className,\n  truncate = false,\n}: MessageContentProps) {\n  const isUser = message.role === ChatMessageRoleUser;\n  const textContent = getTextContent(message);\n  const imageUrls = getImageUrls(message);\n  const fileUrls = getFileUrls(message);\n\n  const [isExpanded, setIsExpanded] = useState(false);\n  const MAX_LENGTH = 500;\n  const shouldTruncate = truncate && isUser && textContent.length > MAX_LENGTH;\n  const displayContent = shouldTruncate && !isExpanded\n    ? textContent.slice(0, MAX_LENGTH) + '...'\n    : textContent;\n\n  // Don't render if no content\n  if (!textContent && imageUrls.length === 0 && fileUrls.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={cn('w-full', className)}>\n      {/* Images */}\n      {imageUrls.length > 0 && (\n        <div className=\"mb-3 flex flex-wrap gap-2\">\n          {imageUrls.map((url, index) => (\n            <ImageAttachment key={index} url={url} />\n          ))}\n        </div>\n      )}\n\n      {/* Files */}\n      {fileUrls.length > 0 && (\n        <div className=\"mb-3 flex flex-wrap gap-2\">\n          {fileUrls.map((url, index) => (\n            <FileAttachment key={index} url={url} />\n          ))}\n        </div>\n      )}\n\n      {/* Text content */}\n      {textContent && (\n        <div className=\"w-full\">\n          {isUser ? (\n            <div className=\"flex flex-col gap-2\">\n              <div className=\"whitespace-pre-wrap\">{displayContent}</div>\n              {shouldTruncate && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setIsExpanded(!isExpanded)}\n                  className=\"self-end text-xs h-6 px-2 text-muted-foreground hover:text-foreground cursor-pointer\"\n                >\n                  {isExpanded ? 'show less' : 'show more'}\n                </Button>\n              )}\n            </div>\n          ) : (\n            <MarkdownRenderer content={textContent} />\n          )}\n        </div>\n      )}\n    </div>\n  );\n});\n\nMessageContent.displayName = 'MessageContent';\n\n",
      "type": "registry:component",
      "target": "components/agent/message-content.tsx"
    },
    {
      "path": "registry/blocks/chat/components/message-reasoning.tsx",
      "content": "/**\n * MessageReasoning Primitive\n * \n * Collapsible block for displaying reasoning/thinking content.\n */\n\nimport React, { memo, useState } from 'react';\nimport { cn } from '@/lib/utils';\nimport { MarkdownRenderer } from '@/components/markdown-renderer';\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from '@/components/ui/collapsible';\nimport { ChevronRight, MessageCircleDashed } from 'lucide-react';\nimport type { MessageReasoningProps } from '@/components/agent/types';\n\n/**\n * MessageReasoning - Collapsible reasoning block\n * \n * @example\n * ```tsx\n * <MessageReasoning reasoning={reasoningText} isReasoning={true} />\n * ```\n */\nexport const MessageReasoning = memo(function MessageReasoning({\n  reasoning,\n  isReasoning = false,\n  className,\n}: MessageReasoningProps) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  if (!reasoning.trim()) return null;\n\n  // Get the last line of reasoning for preview\n  const getLastLine = () => {\n    const lines = reasoning.trim().split('\\n').filter((line) => line.trim().length > 0);\n    for (let i = lines.length - 1; i >= 0; i--) {\n      const line = lines[i].trim();\n      if (line.length > 50) {\n        return line.length > 60 ? line.slice(0, 60) + '...' : line;\n      }\n    }\n    return null;\n  };\n\n  const label = isReasoning ? 'thinking' : 'thought';\n  const preview =\n    isReasoning && getLastLine() ? (\n      <span className=\"text-xs text-muted-foreground/40 truncate max-w-[300px] lowercase ml-2\">\n        - {getLastLine()}\n      </span>\n    ) : null;\n\n  return (\n    <div className={cn('flex flex-col items-start w-fit mb-2', className)}>\n      <Collapsible\n        open={isOpen}\n        onOpenChange={setIsOpen}\n        className={cn(\n          'group w-full overflow-hidden rounded-lg text-muted-foreground',\n          isOpen && 'border bg-muted/10'\n        )}\n      >\n        <div className=\"flex items-center p-2\">\n          <CollapsibleTrigger asChild>\n            <button className=\"flex items-center gap-2 text-sm text-muted-foreground/50 hover:text-muted-foreground cursor-pointer\">\n              {isOpen ? (\n                <ChevronRight className=\"h-4 w-4 rotate-90 transition-transform\" />\n              ) : (\n                <MessageCircleDashed className=\"h-4 w-4\" />\n              )}\n              <span className={cn('relative text-sm', isReasoning && 'animate-pulse')}>\n                {label}\n              </span>\n              {!isOpen && preview}\n            </button>\n          </CollapsibleTrigger>\n        </div>\n        <CollapsibleContent>\n          <div className=\"border-t p-2\">\n            <div className=\"whitespace-pre-wrap text-xs max-h-[200px] overflow-y-auto\">\n              <MarkdownRenderer content={reasoning} compact={true} />\n            </div>\n          </div>\n        </CollapsibleContent>\n      </Collapsible>\n    </div>\n  );\n});\n\nMessageReasoning.displayName = 'MessageReasoning';\n\n",
      "type": "registry:component",
      "target": "components/agent/message-reasoning.tsx"
    },
    {
      "path": "registry/blocks/chat/components/message-status-indicator.tsx",
      "content": "/**\n * MessageStatusIndicator Primitive\n * \n * Shows loading state when a message is still being generated.\n */\n\nimport React, { memo } from 'react';\nimport { cn } from '@/lib/utils';\nimport { Spinner } from '@/components/ui/spinner';\n\n// =============================================================================\n// Props\n// =============================================================================\n\nexport interface MessageStatusIndicatorProps {\n  /** Additional CSS classes */\n  className?: string;\n  /** Size of the loader icon */\n  size?: number;\n  /** Whether to show text label */\n  showLabel?: boolean;\n  /** Custom label text (defaults to \"generating...\") */\n  label?: string;\n}\n\n// =============================================================================\n// Component\n// =============================================================================\n\n/**\n * MessageStatusIndicator - Shows when a message is still being generated\n * \n * Place this at the end of a message to show the assistant is still working.\n * It will automatically hide when the message reaches a terminal status.\n * \n * @example\n * ```tsx\n * <MessageBubble message={message}>\n *   <MessageContent message={message} />\n *   <ToolInvocations message={message} />\n *   <MessageStatusIndicator message={message} />\n * </MessageBubble>\n * ```\n * \n * @example With custom styling\n * ```tsx\n * <MessageStatusIndicator \n *   message={message} \n *   size={16}\n *   showLabel={false}\n *   className=\"mt-2\"\n * />\n * ```\n */\nexport const MessageStatusIndicator = memo(function MessageStatusIndicator({\n  className,\n  size = 18,\n  showLabel = true,\n  label = 'generating...',\n}: MessageStatusIndicatorProps) {\n\n  return (\n    <div\n      className={cn(\n        'flex items-center gap-2 text-muted-foreground py-1',\n        className\n      )}\n    >\n      <Spinner className=\"size-4\" style={{ width: size, height: size }} />\n      {showLabel && (\n        <span className=\"text-xs opacity-70\">{label}</span>\n      )}\n    </div>\n  );\n});\n\nMessageStatusIndicator.displayName = 'MessageStatusIndicator';\n",
      "type": "registry:component",
      "target": "components/agent/message-status-indicator.tsx"
    },
    {
      "path": "registry/blocks/chat/components/file-upload.tsx",
      "content": "/**\n * File Upload Primitives\n * \n * Components for file upload with progress tracking.\n * Uses SDK client for file uploads.\n */\n\nimport React, { memo, useCallback, useState, useEffect, useContext } from 'react';\nimport { cn } from '@/lib/utils';\nimport { X, FileIcon, Check, AlertCircle } from 'lucide-react';\nimport { Spinner } from '@/components/ui/spinner';\nimport { AgentContext } from '@/components/agent/context';\nimport type { File as FileDTO } from '@inferencesh/sdk';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type UploadStatus = 'pending' | 'uploading' | 'completed' | 'failed' | 'cancelled';\n\nexport interface FileUpload {\n  id: string;\n  file: File;\n  status: UploadStatus;\n  progress: number;\n  uploadedFile?: FileDTO;\n  error?: string;\n  abortController?: AbortController;\n}\n\nexport interface FileUploadManagerState {\n  uploads: FileUpload[];\n  addFiles: (files: File[]) => void;\n  removeUpload: (id: string) => void;\n  cancelUpload: (id: string) => void;\n  clearCompleted: () => void;\n  getCompletedFiles: () => FileDTO[];\n}\n\n// =============================================================================\n// Hook: useFileUploadManager\n// =============================================================================\n\nexport function useFileUploadManager(): FileUploadManagerState {\n  const [uploads, setUploads] = useState<FileUpload[]>([]);\n  const context = useContext(AgentContext);\n\n  const uploadFile = useCallback(async (upload: FileUpload) => {\n    const abortController = new AbortController();\n\n    setUploads(prev => prev.map(u =>\n      u.id === upload.id ? { ...u, status: 'uploading' as const, abortController } : u\n    ));\n\n    try {\n      // Get client from context and upload file\n      if (!context) {\n        throw new Error('No AgentContext available for file uploads');\n      }\n\n      const { client } = context;\n      if (!client?.uploadFile) {\n        throw new Error('Client does not support file uploads');\n      }\n\n      const result = await client.uploadFile(upload.file);\n\n      if (abortController.signal.aborted) {\n        return;\n      }\n\n      setUploads(prev => prev.map(u =>\n        u.id === upload.id ? { ...u, status: 'completed' as const, progress: 100, uploadedFile: result } : u\n      ));\n    } catch (error) {\n      if (abortController.signal.aborted) {\n        return;\n      }\n      setUploads(prev => prev.map(u =>\n        u.id === upload.id ? {\n          ...u,\n          status: 'failed' as const,\n          error: error instanceof Error ? error.message : 'Upload failed',\n          progress: 0\n        } : u\n      ));\n    }\n  }, [context]);\n\n  const addFiles = useCallback((files: File[]) => {\n    const newUploads: FileUpload[] = files.map(file => ({\n      id: `${file.name}-${Date.now()}-${Math.random().toString(36).slice(2)}`,\n      file,\n      status: 'pending' as const,\n      progress: 0,\n    }));\n\n    setUploads(prev => [...prev, ...newUploads]);\n\n    newUploads.forEach(upload => {\n      uploadFile(upload);\n    });\n  }, [uploadFile]);\n\n  const removeUpload = useCallback((id: string) => {\n    setUploads(prev => {\n      const upload = prev.find(u => u.id === id);\n      if (upload?.abortController) {\n        upload.abortController.abort();\n      }\n      return prev.filter(u => u.id !== id);\n    });\n  }, []);\n\n  const cancelUpload = useCallback((id: string) => {\n    setUploads(prev => prev.map(u => {\n      if (u.id === id && u.status === 'uploading') {\n        u.abortController?.abort();\n        return { ...u, status: 'cancelled' as const, progress: 0 };\n      }\n      return u;\n    }));\n  }, []);\n\n  const clearCompleted = useCallback(() => {\n    setUploads(prev => prev.filter(u => u.status !== 'completed' && u.status !== 'failed' && u.status !== 'cancelled'));\n  }, []);\n\n  const getCompletedFiles = useCallback(() => {\n    return uploads\n      .filter(u => u.status === 'completed' && u.uploadedFile)\n      .map(u => u.uploadedFile!);\n  }, [uploads]);\n\n  return {\n    uploads,\n    addFiles,\n    removeUpload,\n    cancelUpload,\n    clearCompleted,\n    getCompletedFiles,\n  };\n}\n\n// =============================================================================\n// File Type Helpers\n// =============================================================================\n\nfunction getFileType(file: File): 'image' | 'video' | 'text' | 'generic' {\n  if (file.type.startsWith('image/')) return 'image';\n  if (file.type.startsWith('video/')) return 'video';\n  if (\n    file.type.startsWith('text/') ||\n    file.name.endsWith('.txt') ||\n    file.name.endsWith('.md') ||\n    file.name.endsWith('.csv') ||\n    file.name.endsWith('.json') ||\n    file.name.endsWith('.xml') ||\n    file.name.endsWith('.yaml') ||\n    file.name.endsWith('.yml')\n  ) {\n    return 'text';\n  }\n  return 'generic';\n}\n\nfunction getFileExtension(filename: string): string {\n  const ext = filename.split('.').pop()?.toUpperCase() || '';\n  return ext.length <= 4 ? ext : ext.slice(0, 4);\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\n}\n\n// =============================================================================\n// FileUploadPreview Component\n// =============================================================================\n\ninterface FileUploadPreviewProps {\n  upload: FileUpload;\n  onRemove: () => void;\n  onCancel?: () => void;\n  className?: string;\n}\n\nexport const FileUploadPreview = memo(function FileUploadPreview({\n  upload,\n  onRemove,\n  onCancel,\n  className,\n}: FileUploadPreviewProps) {\n  const { file, status, progress, error, uploadedFile } = upload;\n  const fileType = getFileType(file);\n  const previewUrl = (fileType === 'image' || fileType === 'video')\n    ? URL.createObjectURL(file)\n    : null;\n  const [textPreview, setTextPreview] = useState<string>('');\n\n  useEffect(() => {\n    if (fileType === 'text') {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const text = e.target?.result as string;\n        setTextPreview(text.slice(0, 100));\n      };\n      reader.readAsText(file.slice(0, 200));\n    }\n  }, [file, fileType]);\n\n  const handleRemoveOrCancel = () => {\n    if (status === 'uploading' && onCancel) {\n      onCancel();\n    } else {\n      onRemove();\n    }\n  };\n\n  const handlePreviewClick = () => {\n    if (status === 'completed' && uploadedFile?.uri) {\n      window.open(uploadedFile.uri, '_blank');\n    } else if (previewUrl) {\n      window.open(previewUrl, '_blank');\n    }\n  };\n\n  const isClickable = status === 'completed' || previewUrl;\n\n  return (\n    <div\n      className={cn(\n        'relative flex items-center gap-2.5 rounded-lg border bg-muted/30 p-1.5 pr-8',\n        'max-w-[220px] animate-in fade-in slide-in-from-bottom-2 duration-150',\n        status === 'failed' && 'border-destructive/50 bg-destructive/10',\n        status === 'completed' && 'border-border',\n        className\n      )}\n    >\n      {/* Thumbnail */}\n      <div\n        className={cn(\n          'relative h-10 w-10 shrink-0 overflow-hidden rounded-md border bg-muted',\n          isClickable && 'cursor-pointer hover:opacity-80 transition-opacity'\n        )}\n        onClick={isClickable ? handlePreviewClick : undefined}\n      >\n        {fileType === 'image' && previewUrl && (\n          <img src={previewUrl} alt={file.name} className=\"h-full w-full object-cover\" />\n        )}\n\n        {fileType === 'video' && previewUrl && (\n          <div className=\"relative h-full w-full\">\n            <video src={previewUrl} className=\"h-full w-full object-cover\" muted />\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/20\">\n              <div className=\"rounded-full bg-white/90 p-1\">\n                <svg className=\"h-3 w-3 text-black\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path d=\"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {fileType === 'text' && (\n          <div className=\"flex h-full w-full flex-col items-center justify-center p-0.5\">\n            <div className=\"h-full w-full overflow-hidden rounded-sm bg-background/50 p-0.5\">\n              <div className=\"text-[5px] leading-tight text-muted-foreground/70 line-clamp-4\">\n                {textPreview || '...'}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {fileType === 'generic' && (\n          <div className=\"flex h-full w-full flex-col items-center justify-center\">\n            <FileIcon className=\"h-4 w-4 text-muted-foreground\" />\n            <span className=\"text-[7px] font-medium text-muted-foreground mt-0.5\">\n              {getFileExtension(file.name)}\n            </span>\n          </div>\n        )}\n\n        {status === 'uploading' && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-background/80\">\n            <Spinner className=\"size-4 text-primary\" />\n          </div>\n        )}\n\n        {status === 'completed' && (\n          <div className=\"absolute -bottom-1 -right-1 rounded-full bg-emerald-500 p-0.5 shadow-sm\">\n            <Check className=\"h-2 w-2 text-white\" />\n          </div>\n        )}\n        {status === 'failed' && (\n          <div className=\"absolute -bottom-1 -right-1 rounded-full bg-destructive p-0.5 shadow-sm\">\n            <AlertCircle className=\"h-2 w-2 text-white\" />\n          </div>\n        )}\n      </div>\n\n      {/* File info */}\n      <div className=\"flex-1 min-w-0\">\n        <p\n          className={cn(\n            'truncate text-xs font-medium',\n            isClickable && 'cursor-pointer hover:underline'\n          )}\n          onClick={isClickable ? handlePreviewClick : undefined}\n        >\n          {file.name}\n        </p>\n        <p className=\"text-[10px] text-muted-foreground\">\n          {status === 'uploading' && 'uploading...'}\n          {status === 'completed' && formatFileSize(file.size)}\n          {status === 'failed' && (error || 'upload failed')}\n          {status === 'cancelled' && 'cancelled'}\n          {status === 'pending' && 'waiting...'}\n        </p>\n      </div>\n\n      {/* Remove/Cancel button */}\n      <button\n        type=\"button\"\n        onClick={handleRemoveOrCancel}\n        className={cn(\n          'absolute right-1 top-1 rounded-full p-1 transition-colors cursor-pointer',\n          'hover:bg-muted-foreground/20',\n          status === 'uploading' && 'hover:bg-destructive/20 hover:text-destructive'\n        )}\n        aria-label={status === 'uploading' ? 'Cancel upload' : 'Remove file'}\n      >\n        <X className=\"h-3 w-3\" />\n      </button>\n\n      {/* Progress bar */}\n      {status === 'uploading' && (\n        <div className=\"absolute bottom-0 left-0 right-0 h-0.5 overflow-hidden rounded-b-lg bg-muted\">\n          <div\n            className=\"h-full bg-primary transition-all duration-300\"\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n      )}\n    </div>\n  );\n});\n\n// =============================================================================\n// FileUploadList Component\n// =============================================================================\n\ninterface FileUploadListProps {\n  uploads: FileUpload[];\n  onRemove: (id: string) => void;\n  onCancel: (id: string) => void;\n  className?: string;\n}\n\nexport const FileUploadList = memo(function FileUploadList({\n  uploads,\n  onRemove,\n  onCancel,\n  className,\n}: FileUploadListProps) {\n  if (uploads.length === 0) return null;\n\n  return (\n    <div className={cn('flex flex-wrap gap-2', className)}>\n      {uploads.map(upload => (\n        <FileUploadPreview\n          key={upload.id}\n          upload={upload}\n          onRemove={() => onRemove(upload.id)}\n          onCancel={() => onCancel(upload.id)}\n        />\n      ))}\n    </div>\n  );\n});\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\nexport function showFileUploadDialog(accept: string = '*/*'): Promise<File[] | null> {\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.multiple = true;\n  input.accept = accept;\n  input.click();\n\n  return new Promise((resolve) => {\n    input.onchange = (e) => {\n      const files = (e.currentTarget as HTMLInputElement).files;\n      if (files) {\n        resolve(Array.from(files));\n        return;\n      }\n      resolve(null);\n    };\n  });\n}\n",
      "type": "registry:component",
      "target": "components/agent/file-upload.tsx"
    },
    {
      "path": "registry/blocks/chat/lib/use-auto-scroll.ts",
      "content": "/**\n * useAutoScroll Hook\n * \n * Auto-scrolls container to bottom when content changes.\n * Returns refs and handlers for scroll management.\n */\n\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\n// How many pixels from the bottom of the container to enable auto-scroll\nconst ACTIVATION_THRESHOLD = 50;\n// Minimum pixels of scroll-up movement required to disable auto-scroll\nconst MIN_SCROLL_UP_THRESHOLD = 10;\n\nexport function useAutoScroll(dependencies: React.DependencyList) {\n    const containerRef = useRef<HTMLDivElement | null>(null);\n    const previousScrollTop = useRef<number | null>(null);\n    const [shouldAutoScroll, setShouldAutoScroll] = useState(true);\n    // Use a ref to track current value for ResizeObserver callback (avoids re-subscribing)\n    const shouldAutoScrollRef = useRef(shouldAutoScroll);\n    shouldAutoScrollRef.current = shouldAutoScroll;\n\n    const scrollToBottom = useCallback(() => {\n        if (containerRef.current) {\n            containerRef.current.scrollTop = containerRef.current.scrollHeight;\n        }\n    }, []);\n\n    const handleScroll = useCallback(() => {\n        if (containerRef.current) {\n            const { scrollTop, scrollHeight, clientHeight } = containerRef.current;\n\n            // Detect Safari's rubber-band/bounce scrolling at edges.\n            // When bouncing, scrollTop can go negative (top) or exceed max (bottom).\n            // Ignore these events to avoid false \"deliberate scroll up\" detection.\n            const isOverscrolling =\n                scrollTop < 0 || scrollTop + clientHeight > scrollHeight + 1;\n\n            if (isOverscrolling) {\n                // Don't update previousScrollTop during overscroll to avoid\n                // detecting the bounce-back as intentional scrolling\n                return;\n            }\n\n            const distanceFromBottom = Math.abs(\n                scrollHeight - scrollTop - clientHeight\n            );\n\n            const isScrollingUp = previousScrollTop.current !== null\n                ? scrollTop < previousScrollTop.current\n                : false;\n\n            const scrollUpDistance = previousScrollTop.current !== null\n                ? previousScrollTop.current - scrollTop\n                : 0;\n\n            const isDeliberateScrollUp =\n                isScrollingUp && scrollUpDistance > MIN_SCROLL_UP_THRESHOLD;\n\n            // Check if we're at the bottom\n            const isScrolledToBottom = distanceFromBottom < ACTIVATION_THRESHOLD;\n\n            if (isDeliberateScrollUp && !isScrolledToBottom) {\n                // User deliberately scrolled up AND is not at bottom - disable auto-scroll\n                setShouldAutoScroll(false);\n            } else if (!isScrollingUp || isScrolledToBottom) {\n                // Either scrolling down, or content changed, or at bottom\n                setShouldAutoScroll(isScrolledToBottom);\n            }\n            // When scrolling up but not deliberately (small amounts), do nothing\n            // to avoid toggling shouldAutoScroll and causing feedback loops\n\n            previousScrollTop.current = scrollTop;\n        }\n    }, []);\n\n    const handleTouchStart = useCallback(() => {\n        setShouldAutoScroll(false);\n    }, []);\n\n    useEffect(() => {\n        if (containerRef.current) {\n            previousScrollTop.current = containerRef.current.scrollTop;\n        }\n    }, []);\n\n    // Observe content height changes and auto-scroll if needed\n    useEffect(() => {\n        const container = containerRef.current;\n        if (!container) return;\n\n        let previousHeight = container.scrollHeight;\n\n        const resizeObserver = new ResizeObserver(() => {\n            const currentHeight = container.scrollHeight;\n            // Only auto-scroll when content grows, not when it shrinks\n            // (e.g., when generating indicator disappears)\n            if (shouldAutoScrollRef.current && currentHeight > previousHeight) {\n                scrollToBottom();\n            }\n            previousHeight = currentHeight;\n        });\n\n        // Observe the container itself for size changes\n        resizeObserver.observe(container);\n\n        return () => {\n            resizeObserver.disconnect();\n        };\n    }, [scrollToBottom]);\n\n    useEffect(() => {\n        if (shouldAutoScroll) {\n            scrollToBottom();\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, dependencies);\n\n    return {\n        containerRef,\n        scrollToBottom,\n        handleScroll,\n        shouldAutoScroll,\n        handleTouchStart,\n    };\n}\n",
      "type": "registry:hook",
      "target": "hooks/use-auto-scroll.ts"
    }
  ]
}