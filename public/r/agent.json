{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "agent",
  "title": "Agent Chat",
  "description": "Full-featured AI agent chat with state management, tools, and widgets.",
  "dependencies": [
    "@inferencesh/sdk"
  ],
  "registryDependencies": [
    "button",
    "https://ui.inference.sh/r/chat.json",
    "https://ui.inference.sh/r/tools.json",
    "https://ui.inference.sh/r/widgets.json"
  ],
  "files": [
    {
      "path": "registry/blocks/agent/agent.tsx",
      "content": "/**\n * Agent - Pre-composed Chat Component\n *\n * Ready-to-use chat UI built from primitives.\n * Uses @inferencesh/sdk/agent for state management.\n */\n\nimport React, { memo, useMemo } from 'react';\nimport { cn } from '@/lib/utils';\nimport { Bot } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport {\n  Inference,\n  ChatMessageStatusReady,\n  ChatMessageStatusFailed,\n  ChatMessageStatusCancelled,\n  ChatMessageRoleUser,\n  ChatMessageRoleAssistant,\n  ChatMessageContentTypeReasoning,\n  ChatMessageContentTypeText,\n} from '@inferencesh/sdk';\nimport {\n  AgentChatProvider,\n  useAgentChat,\n  useAgentActions,\n  isAdHocConfig,\n  type ChatMessageDTO,\n  type AgentOptions,\n} from '@inferencesh/sdk/agent';\nimport { ChatContainer } from '@/components/infsh/agent/chat-container';\nimport { ChatMessages } from '@/components/infsh/agent/chat-messages';\nimport { ChatInput } from '@/components/infsh/agent/chat-input';\nimport { MessageBubble } from '@/components/infsh/agent/message-bubble';\nimport { MessageContent } from '@/components/infsh/agent/message-content';\nimport { MessageReasoning } from '@/components/infsh/agent/message-reasoning';\nimport { MessageStatusIndicator } from '@/components/infsh/agent/message-status-indicator';\nimport { ToolInvocations } from '@/components/infsh/agent/tool-invocations';\n\n// Component props\ninterface AgentProps {\n  proxyUrl?: string;\n  apiKey?: string;\n  baseUrl?: string;\n  config: AgentOptions;\n  name?: string;\n  chatId?: string;\n  className?: string;\n  compact?: boolean;\n  allowFiles?: boolean;\n  allowImages?: boolean;\n  onChatCreated?: (chatId: string) => void;\n  description?: string;\n  examplePrompts?: string[];\n}\n\n// Check if message status is terminal (generation complete)\nfunction isTerminalStatus(status: string | undefined): boolean {\n  return status === ChatMessageStatusReady ||\n    status === ChatMessageStatusFailed ||\n    status === ChatMessageStatusCancelled;\n}\n\n// =============================================================================\n// Helper functions\n// =============================================================================\n\nfunction getTextContent(message: ChatMessageDTO): string {\n  const textContent = message.content.find((c) => c.type === ChatMessageContentTypeText);\n  return textContent?.text ?? '';\n}\n\nfunction getReasoningContent(message: ChatMessageDTO): string | undefined {\n  const reasoningContent = message.content.find((c) => c.type === ChatMessageContentTypeReasoning);\n  return reasoningContent?.text;\n}\n\nfunction hasTextContent(message: ChatMessageDTO): boolean {\n  return message.content.some((c) => c.type === ChatMessageContentTypeText && c.text?.trim());\n}\n\n// =============================================================================\n// Internal Components\n// =============================================================================\n\nconst DefaultHeader = memo(function DefaultHeader() {\n  return (\n    <div className=\"flex items-center gap-2 px-4 py-3 border-b\">\n      <Bot className=\"h-4 w-4 text-primary\" />\n      <span className=\"font-medium text-sm\">agent</span>\n    </div>\n  );\n});\n\nconst ExamplePrompts = memo(function ExamplePrompts({\n  prompts,\n  onSelect,\n}: {\n  prompts: string[];\n  onSelect: (prompt: string) => void;\n}) {\n  if (prompts.length === 0) return null;\n\n  return (\n    <div className=\"mt-4 space-y-2 w-full max-w-md\">\n      {prompts.map((prompt, idx) => (\n        <Button\n          key={idx}\n          variant=\"outline\"\n          onClick={() => onSelect(prompt)}\n          className=\"w-full text-left justify-start h-auto py-2 px-3 text-sm whitespace-normal\"\n        >\n          {prompt}\n        </Button>\n      ))}\n    </div>\n  );\n});\n\nconst EmptyState = memo(function EmptyState({\n  description,\n  examplePrompts = [],\n}: {\n  description?: string;\n  examplePrompts?: string[];\n}) {\n  const { sendMessage } = useAgentActions();\n\n  return (\n    <div className=\"flex-1 flex flex-col items-center justify-center text-center p-6 text-muted-foreground\">\n      <Bot className=\"h-8 w-8 mb-3 opacity-50\" />\n      <p className=\"text-sm font-medium\">how can I help?</p>\n      <p className=\"text-xs mt-1 opacity-70\">\n        {description || 'ask me anything'}\n      </p>\n      {examplePrompts.length > 0 && (\n        <ExamplePrompts prompts={examplePrompts} onSelect={sendMessage} />\n      )}\n    </div>\n  );\n});\n\nconst MessageRow = memo(function MessageRow({\n  message,\n  isLast,\n}: {\n  message: ChatMessageDTO;\n  isLast: boolean;\n}) {\n  const isUser = message.role === ChatMessageRoleUser;\n  const isAssistant = message.role === ChatMessageRoleAssistant;\n  const reasoningContent = getReasoningContent(message);\n  const isGenerating = !isTerminalStatus(message.status);\n  const hasTools = message.tool_invocations && message.tool_invocations.length > 0;\n\n  if (message.role === 'tool') {\n    return null;\n  }\n\n  if (!hasTextContent(message) && !reasoningContent && !hasTools) {\n    return null;\n  }\n\n  return (\n    <MessageBubble message={message}>\n      {isAssistant && reasoningContent && (\n        <MessageReasoning\n          reasoning={reasoningContent}\n          isReasoning={isGenerating && !hasTextContent(message)}\n        />\n      )}\n      <MessageContent message={message} truncate={isUser} />\n      {isAssistant && <ToolInvocations message={message} />}\n      {isAssistant && isGenerating && <MessageStatusIndicator />}\n    </MessageBubble>\n  );\n});\n\nconst MessageList = memo(function MessageList({\n  messages,\n  isGenerating,\n}: {\n  messages: ChatMessageDTO[];\n  isGenerating: boolean;\n}) {\n  // Show typing indicator when generating and last message is user or has no content yet\n  const lastMessage = messages[messages.length - 1];\n  const showTyping =\n    isGenerating &&\n    (!lastMessage ||\n      lastMessage.role === 'user' ||\n      !lastMessage.content?.some(c => c.type === 'text' && c.text?.trim()));\n\n  return (\n    <div className=\"space-y-4 p-4\">\n      {messages.map((message, index) => (\n        <MessageRow\n          key={message.id}\n          message={message}\n          isLast={index === messages.length - 1}\n        />\n      ))}\n      {showTyping && <MessageStatusIndicator label=\"thinking...\" />}\n    </div>\n  );\n});\n\nconst AgentContent = memo(function AgentContent({\n  className,\n  compact,\n  allowFiles = true,\n  allowImages = true,\n  description,\n  examplePrompts,\n}: {\n  className?: string;\n  compact?: boolean;\n  allowFiles?: boolean;\n  allowImages?: boolean;\n  description?: string;\n  examplePrompts?: string[];\n}) {\n  const { messages, isGenerating } = useAgentChat();\n  const hasMessages = messages.length > 0;\n\n  return (\n    <ChatContainer className={cn('h-full p-2', className)}>\n      {!compact && <DefaultHeader />}\n      {hasMessages ? (\n        <ChatMessages className=\"flex-1\">\n          {({ messages }) => <MessageList messages={messages} isGenerating={isGenerating} />}\n        </ChatMessages>\n      ) : (\n        <EmptyState description={description} examplePrompts={examplePrompts} />\n      )}\n      <ChatInput allowFiles={allowFiles} allowImages={allowImages} />\n    </ChatContainer>\n  );\n});\n\n// =============================================================================\n// Main Component\n// =============================================================================\n\nexport function Agent({\n  proxyUrl,\n  apiKey,\n  baseUrl,\n  config,\n  name,\n  chatId,\n  className,\n  compact = false,\n  allowFiles = true,\n  allowImages = true,\n  onChatCreated,\n  description,\n  examplePrompts,\n}: AgentProps) {\n  // Create client internally - memoized to prevent re-creation\n  const client = useMemo(() => {\n    if (!proxyUrl && !apiKey) {\n      console.error('[Agent] Either proxyUrl or apiKey is required');\n      return null;\n    }\n    return new Inference({ proxyUrl, apiKey, baseUrl });\n  }, [proxyUrl, apiKey, baseUrl]);\n\n  if (!client) {\n    return null;\n  }\n\n  // Extract description and example prompts from ad-hoc config, or use props\n  const effectiveDescription = description ?? (isAdHocConfig(config) ? config.description : undefined);\n  const effectiveExamplePrompts = examplePrompts ?? (isAdHocConfig(config) ? config.example_prompts : undefined);\n\n  return (\n    <AgentChatProvider\n      client={client}\n      agentConfig={config}\n      chatId={chatId}\n      onChatCreated={onChatCreated}\n    >\n      <AgentContent\n        className={className}\n        compact={compact}\n        allowFiles={allowFiles}\n        allowImages={allowImages}\n        description={effectiveDescription}\n        examplePrompts={effectiveExamplePrompts}\n      />\n    </AgentChatProvider>\n  );\n}\n\nAgent.displayName = 'Agent';\n",
      "type": "registry:component",
      "target": "components/infsh/agent/agent.tsx"
    }
  ],
  "type": "registry:block"
}